<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabrofood - Sistema POS</title>
    
    <!-- META TAGS ANTI-CACH√â -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="stylesheet" href="style.css?v=20260119-fix">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-icon">ÔøΩ</div>
                <h1>Sabrofood</h1>
                <p>Sistema de Punto de Venta</p>
            </div>
            <div class="login-body">
                <div class="form-group">
                    <label for="loginUsername">Vendedor</label>
                    <select id="loginUsername" class="form-select">
                        <option value="">Seleccionar vendedor...</option>
                        <option value="Jonathan R.">Jonathan R.</option>
                        <option value="Sebastian">Sebastian</option>
                        <option value="Pablo">Pablo</option>
                        <option value="Hugo">Hugo</option>
                        <option value="Tonio">Tonio</option>
                        <option value="Diego Sr.">Diego Sr. (Padre)</option>
                        <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                        <option value="Emil">Emil</option>
                        <option value="Jonathan J.">Jonathan J.</option>
                        <option value="Admin">Admin (Encargado)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input 
                        type="password" 
                        id="loginPassword" 
                        class="form-input" 
                        placeholder="Ingresa tu contrase√±a"
                        onkeypress="if(event.key==='Enter') handleLogin()"
                    >
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberDevice">
                        <span>Recordar en este dispositivo</span>
                    </label>
                </div>
                
                <button id="loginBtn" class="btn btn-primary btn-block" onclick="handleLogin()">
                    <span>Iniciar Sesi√≥n</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                
                <!-- Bot√≥n de actualizaci√≥n forzada -->
                <button 
                    type="button"
                    onclick="forzarActualizacion()" 
                    class="btn-link btn-force-update"
                >
                    üîÑ ¬øNo ves tus productos? Haz clic aqu√≠
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="app-container" style="display: none;">
        <!-- SIDEBAR (Desktop) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="logo-icon">ÔøΩ</span>
                    <span class="logo-text">Sabrofood</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-view="pos" onclick="cambiarVista('pos')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Punto de Venta</span>
                </button>
                
                <button class="nav-item" data-view="inventory" onclick="cambiarVista('inventory')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 3H8v4h8V3z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Inventario</span>
                </button>
                
                <button class="nav-item" data-view="sales" onclick="cambiarVista('sales')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M18 17l-5-5-4 4-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Historial Ventas</span>
                </button>
                
                <button class="nav-item" data-view="asistencia" onclick="cambiarVista('asistencia')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Asistencia</span>
                </button>
                
                <button id="btnCajaGastos" class="nav-item" data-view="caja" onclick="cambiarVista('caja')" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="2" y="7" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="14" r="2" fill="currentColor"/>
                        <path d="M12 16v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Caja y Gastos</span>
                </button>
                
                <button id="btnAsignarCodigos" class="nav-item" data-view="asignar" onclick="cambiarVista('asignar')" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M7 9h2M7 12h2M7 15h2M11 9h6M11 12h6M11 15h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span>Asignar C√≥digos</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="2"/>
                            <path d="M4 17c0-2.8 2.7-5 6-5s6 2.2 6 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="sidebarUsername">Usuario</div>
                        <div class="user-role">Vendedor</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- POS VIEW -->
            <div id="posView" class="view-container">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Punto de Venta</h2>
                        <p class="view-subtitle">Gestiona tus ventas</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="abrirEscaner()" style="margin-right: 12px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M9 9h6M9 12h6M9 15h6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>ESCANEAR</span>
                        </button>
                        
                        <span class="user-badge" id="topUsername">Usuario</span>
                        
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="pos-layout">
                    <div class="pos-products">
                        <!-- Search -->
                        <div class="search-box">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                                <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                                <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <input type="text" id="searchInput" placeholder="Buscar productos..." class="search-input">
                        </div>

                        <!-- Barcode Search -->
                        <div class="search-box barcode-search">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="search-icon">
                                <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M7 9h2M7 12h2M7 15h2M11 9h6M11 12h6M11 15h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                            <input type="text" id="inputCodigoBarras" placeholder="Buscar por c√≥digo de barras (Enter)..." class="search-input">
                        </div>

                        <!-- Categories -->
                        <div class="categories-scroll">
                            <button class="category-chip active" data-categoria="Todos" onclick="filtrarCategoria('Todos')">Todos</button>
                            <button class="category-chip" data-categoria="Adulto" onclick="filtrarCategoria('Adulto')">üêï Adulto</button>
                            <button class="category-chip" data-categoria="Cachorro" onclick="filtrarCategoria('Cachorro')">üê∂ Cachorro</button>
                            <button class="category-chip" data-categoria="Senior" onclick="filtrarCategoria('Senior')">ü¶¥ Senior</button>
                            <button class="category-chip" data-categoria="Gato" onclick="filtrarCategoria('Gato')">üêà Gato</button>
                            <button class="category-chip" data-categoria="Gatito" onclick="filtrarCategoria('Gatito')">üê± Gatito</button>
                            <button class="category-chip" data-categoria="Arena" onclick="filtrarCategoria('Arena')">üèñÔ∏è Arena</button>
                            <button class="category-chip" data-categoria="Snacks" onclick="filtrarCategoria('Snacks')">üçñ Snacks</button>
                            <button class="category-chip" data-categoria="Accesorios" onclick="filtrarCategoria('Accesorios')">üéæ Accesorios</button>
                        </div>

                        <!-- Products Grid -->
                        <div class="products-grid" id="productosGrid">
                            <div class="loading-state">
                                <div class="spinner"></div>
                                <p>Cargando productos...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Sidebar -->
                    <div class="pos-cart">
                        <div class="cart-header">
                            <h3>Carrito</h3>
                            <button class="btn-icon" onclick="limpiarCarrito()" title="Limpiar carrito">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                                    <path d="M3 6h14M8 6V4a2 2 0 012-2h0a2 2 0 012 2v2m3 0v10a2 2 0 01-2 2H7a2 2 0 01-2-2V6h10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>

                        <div class="cart-items" id="carritoItems">
                            <div class="cart-empty">
                                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                                    <circle cx="32" cy="32" r="30" stroke="currentColor" stroke-width="2" opacity="0.2"/>
                                    <path d="M20 24h24l-2 16H22l-2-16z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="26" cy="48" r="2" fill="currentColor"/>
                                    <circle cx="38" cy="48" r="2" fill="currentColor"/>
                                </svg>
                                <p>Tu carrito est√° vac√≠o</p>
                                <span>Agrega productos para comenzar</span>
                            </div>
                        </div>

                        <div class="cart-footer">
                            <div class="cart-total">
                                <span>Total</span>
                                <span class="total-amount" id="totalAmount">$0</span>
                            </div>
                            <button class="btn btn-success btn-block" id="btnCobrar" onclick="abrirModalCobro()" disabled>
                                <span>Procesar Pago</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INVENTORY VIEW -->
            <div id="inventoryView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Gesti√≥n de Inventario</h2>
                        <p class="view-subtitle">Control de stock y productos</p>
                    </div>
                    <div class="view-actions">
                        <button id="btnAdminPreciosInventario" class="btn btn-primary" onclick="abrirModalAdminPrecios()" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Administrar Precios</span>
                        </button>
                        
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="inventory-content">
                    <div class="inventory-stats">
                        <div class="stat-card">
                            <div class="stat-icon bg-blue">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M4 7h12M4 7l2-4h8l2 4M4 7v9a2 2 0 002 2h8a2 2 0 002-2V7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Total Productos</p>
                                <p class="stat-value" id="totalProductos">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-green">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">En Stock</p>
                                <p class="stat-value" id="enStock">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-orange">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Stock Bajo</p>
                                <p class="stat-value" id="stockBajo">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-red">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 6v4m0 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Sin Stock</p>
                                <p class="stat-value" id="sinStock">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="inventory-table-container">
                        <table class="inventory-table" id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Categor√≠a</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>C√≥digo de Barras</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <div class="loading-state">
                                            <div class="spinner"></div>
                                            <p>Cargando inventario...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- SALES VIEW -->
            <div id="salesView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>üìä An√°lisis de Ventas</h2>
                        <p class="view-subtitle">Dashboard y registro de transacciones</p>
                    </div>
                    <div class="view-actions">
                        <select id="periodoVentas" class="form-select" onchange="actualizarVentas()" style="min-width: 160px;">
                            <option value="7">√öltimos 7 d√≠as</option>
                            <option value="30" selected>√öltimos 30 d√≠as</option>
                            <option value="90">√öltimos 90 d√≠as</option>
                        </select>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="sales-content">
                    <!-- SECCI√ìN 1: KPIs Expandidos -->
                    <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-green" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(34, 197, 94, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üí∞</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Hoy</p>
                                    <p class="kpi-value" id="kpiVentasHoy" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-blue" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(59, 130, 246, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÖ</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Semana</p>
                                    <p class="kpi-value" id="kpiVentasSemana" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-purple" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(168, 85, 247, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÜ</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Mes</p>
                                    <p class="kpi-value" id="kpiVentasMes" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-orange" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(251, 146, 60, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üõí</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ticket Promedio</p>
                                    <p class="kpi-value" id="kpiTicketPromedio" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECCI√ìN 2: Gr√°ficos -->
                    <div class="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 24px;">
                        <!-- Gr√°fico Ventas Diarias -->
                        <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìà Tendencia de Ventas</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="chartVentasDiarias"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico M√©todos de Pago -->
                        <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üí≥ M√©todos de Pago</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="chartMetodosPago"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°fico Top Productos (ancho completo) -->
                    <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üèÜ Top 10 Productos M√°s Vendidos</h3>
                        <div style="height: 350px; position: relative;">
                            <canvas id="chartTopProductos"></canvas>
                        </div>
                    </div>

                    <!-- SECCI√ìN 3: Tabla de Vendedores -->
                    <div id="rankingVendedores" class="vendedores-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üë• Ranking de Vendedores</h3>
                        <div id="tablaVendedores"></div>
                    </div>

                    <!-- SECCI√ìN 4: Tabla de Historial (la actual, mantenerla) -->
                    <div id="historialTransacciones" class="sales-history-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìã Historial de Transacciones</h3>
                        <div class="sales-table-container">
                            <table class="sales-table" id="salesTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha/Hora</th>
                                        <th>Vendedor</th>
                                        <th>Productos</th>
                                        <th>Total</th>
                                        <th>M√©todo Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center">
                                            <div class="loading-state">
                                                <div class="spinner"></div>
                                                <p>Cargando ventas...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ASIGNAR CODIGOS VIEW (Solo Encargado) -->
            <div id="asignarView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Asignar C√≥digos de Barras</h2>
                        <p class="view-subtitle">Gestiona c√≥digos de barras de productos</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="asignar-content">
                    <!-- Search Box -->
                    <div class="search-box" style="margin-bottom: 24px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                            <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <input type="text" id="buscarAsignar" placeholder="Buscar productos sin c√≥digo..." class="search-input" oninput="filtrarProductosAsignar()">
                    </div>

                    <!-- Lista de Productos -->
                    <div id="listaProductosAsignar" style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Cargando productos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ASISTENCIA VIEW -->
            <div id="asistenciaView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>‚è∞ Asistencia</h2>
                        <p class="view-subtitle">Control de horarios de trabajo</p>
                    </div>
                    <div class="view-actions">
                        <span id="topUsernameAsistencia" class="top-username">Usuario</span>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="asistencia-content" style="padding: 24px;">
                    <!-- Estado Actual -->
                    <div id="estadoActual" class="estado-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 24px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìç Estado Actual</h3>
                        <div id="estadoContent">
                            <div class="spinner"></div>
                            <p>Cargando estado...</p>
                        </div>
                    </div>

                    <!-- Botones de Marcaje -->
                    <div class="marcaje-btns" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <button id="btnMarcarEntrada" class="btn btn-success" onclick="marcarEvento('entrada')" style="padding: 20px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Marcar Entrada</div>
                        </button>
                        <button id="btnIniciarAlmuerzo" class="btn btn-warning" onclick="marcarEvento('inicio_almuerzo')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M12 12h9l-9 9v-9zM12 3v9H3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Iniciar Almuerzo</div>
                        </button>
                        <button id="btnTerminarAlmuerzo" class="btn btn-info" onclick="marcarEvento('fin_almuerzo')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 6v6l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <div>Terminar Almuerzo</div>
                        </button>
                        <button id="btnMarcarSalida" class="btn btn-danger" onclick="marcarEvento('salida')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Marcar Salida</div>
                        </button>
                    </div>

                    <!-- Filtros (Solo Admin) -->
                    <div id="filtrosAsistencia" class="filtros-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px; display: none;">
                        <div style="display: flex; gap: 16px; align-items: end; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <label>Vendedor</label>
                                <select id="filtroVendedor" class="form-select" onchange="cargarAsistencias()">
                                    <option value="">Todos los vendedores</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <label>Fecha</label>
                                <input type="date" id="filtroFecha" class="form-input" onchange="cargarAsistencias()">
                            </div>
                            <button class="btn btn-primary" onclick="cargarAsistencias()">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                                    <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span>Buscar</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tabla de Asistencias -->
                    <div style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìã Registro de Asistencias</h3>
                        <div style="overflow-x: auto;">
                            <table class="sales-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Vendedor</th>
                                        <th>Entrada</th>
                                        <th>Inicio Almuerzo</th>
                                        <th>Fin Almuerzo</th>
                                        <th>Salida</th>
                                        <th>Horas</th>
                                        <th>Estado</th>
                                        <th id="thAcciones">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaAsistencias">
                                    <tr>
                                        <td colspan="9" class="text-center">
                                            <div class="loading-state">
                                                <div class="spinner"></div>
                                                <p>Cargando asistencias...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CAJA Y GASTOS VIEW (Solo Encargado) -->
            <div id="cajaView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>üí∞ Caja y Gastos</h2>
                        <p class="view-subtitle">Control de caja diario y arqueo</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="cerrarCajaDiaria()" style="margin-right: 12px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Cerrar Caja</span>
                        </button>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="caja-content">
                    <div class="caja-grid">
                        <!-- PANEL IZQUIERDO: Resumen de Ventas -->
                        <div class="caja-panel">
                            <div class="panel-header">
                                <h3>üìä Ventas del D√≠a</h3>
                                <p class="panel-subtitle" id="cajaFechaHoy">Cargando...</p>
                            </div>
                            
                            <div class="stats-summary">
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        Efectivo
                                    </span>
                                    <span class="stat-value stat-efectivo" id="ventasEfectivo">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                                            <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Tarjeta
                                    </span>
                                    <span class="stat-value stat-transbank" id="ventasTransbank">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M3 3l18 18M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        Transferencia
                                    </span>
                                    <span class="stat-value stat-transferencia" id="ventasTransferencia">$0</span>
                                </div>
                                <div class="stat-row stat-total">
                                    <span class="stat-label"><strong>Total Ventas</strong></span>
                                    <span class="stat-value" id="ventasTotal">$0</span>
                                </div>
                            </div>

                            <!-- Gastos del D√≠a -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üí∏ Gastos del D√≠a</h3>
                            </div>
                            
                            <div class="stats-summary">
                                <div class="stat-row">
                                    <span class="stat-label">Gastos Operacionales</span>
                                    <span class="stat-value stat-gastos" id="gastosTotal">$0</span>
                                </div>
                            </div>

                            <!-- Pagos al Personal -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üë• Pagos al Personal</h3>
                                <p class="panel-subtitle">Pagos registrados hoy</p>
                            </div>
                            
                            <div class="stats-summary">
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2"/>
                                            <path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Empleados Pagados
                                    </span>
                                    <span class="stat-value" id="cantidadEmpleadosPagados">0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">Total Jornadas</span>
                                    <span class="stat-value" style="color: hsl(var(--info));" id="totalJornadas">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">Total Almuerzos</span>
                                    <span class="stat-value" style="color: hsl(var(--warning));" id="totalAlmuerzos">$0</span>
                                </div>
                                <div class="stat-row stat-total" style="background: hsl(var(--success) / 0.1); border: 2px solid hsl(var(--success) / 0.3);">
                                    <span class="stat-label"><strong>üí∞ Total Pagado Personal</strong></span>
                                    <span class="stat-value" style="color: hsl(var(--success));" id="totalPagadoPersonal">$0</span>
                                </div>
                            </div>

                            <!-- Arqueo -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üîç Arqueo de Caja</h3>
                            </div>
                            
                            <div class="arqueo-section">
                                <div class="arqueo-row">
                                    <span>Efectivo Esperado:</span>
                                    <span class="arqueo-value" id="efectivoEsperado">$0</span>
                                </div>
                                <div class="form-group" style="margin: 16px 0;">
                                    <label for="efectivoReal">Efectivo Real en Caja</label>
                                    <input 
                                        type="number" 
                                        id="efectivoReal" 
                                        class="form-input input-efectivo-real" 
                                        placeholder="0"
                                        oninput="calcularDiferenciaCaja()"
                                        style="font-size: 24px; font-weight: 700; text-align: center;"
                                    >
                                </div>
                                <div class="arqueo-row arqueo-diferencia" id="diferenciaContainer" style="display: none;">
                                    <span id="diferenciaLabel">Diferencia:</span>
                                    <span class="arqueo-value" id="diferenciaMonto">$0</span>
                                </div>
                            </div>
                        </div>

                        <!-- PANEL DERECHO: Registro de Gastos -->
                        <div class="caja-panel">
                            <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <h3>‚ûï Registrar Gasto</h3>
                                <button class="btn btn-success" onclick="abrirModalPagoPersonal()" style="padding: 8px 16px; font-size: 14px;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2"/>
                                        <path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span>Pagar Personal</span>
                                </button>
                            </div>
                            
                            <form id="formGasto" class="form-gastos" onsubmit="registrarGasto(event)">
                                <div class="form-group">
                                    <label for="gastoMonto">Monto</label>
                                    <input 
                                        type="number" 
                                        id="gastoMonto" 
                                        class="form-input" 
                                        placeholder="0"
                                        required
                                        min="0"
                                        step="100"
                                    >
                                </div>
                                
                                <div class="form-group">
                                    <label for="gastoDescripcion">Descripci√≥n</label>
                                    <input 
                                        type="text" 
                                        id="gastoDescripcion" 
                                        class="form-input" 
                                        placeholder="Ej: Combustible, Aseo, Insumos"
                                        required
                                    >
                                </div>
                                
                                <div class="form-group">
                                    <label for="gastoAsignado">Asignado a</label>
                                    <select id="gastoAsignado" class="form-select" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="Jonathan R.">Jonathan R.</option>
                                        <option value="Sebastian">Sebastian</option>
                                        <option value="Juan Antonio">Juan Antonio</option>
                                        <option value="Diego Sr.">Diego Sr. (Padre)</option>
                                        <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                                        <option value="Hugo">Hugo</option>
                                        <option value="Pablo">Pablo</option>
                                        <option value="Emil">Emil</option>
                                        <option value="Jonathan J.">Jonathan J.</option>
                                        <option value="Admin">Admin (Encargado)</option>
                                        <option value="Empresa">Gasto Empresa</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-block">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <span>Agregar Gasto</span>
                                </button>
                            </form>

                            <!-- Tabla de Gastos del D√≠a -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üìã Gastos Registrados Hoy</h3>
                            </div>
                            
                            <div class="gastos-list" id="gastosLista">
                                <div class="empty-state">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="opacity: 0.3; margin: 0 auto 16px;">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <p>No hay gastos registrados hoy</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </main>

        <!-- MOBILE BOTTOM NAV -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" data-view="pos" onclick="cambiarVista('pos')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M3 3h6v6H3V3zm8 0h6v6h-6V3zM3 11h6v6H3v-6zm8 0h6v6h-6v-6z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>POS</span>
            </button>
            <button class="bottom-nav-item" data-view="inventory" onclick="cambiarVista('inventory')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M4 7h12M4 7l2-4h8l2 4M4 7v9a2 2 0 002 2h8a2 2 0 002-2V7" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Inventario</span>
            </button>
            <button class="bottom-nav-item" data-view="sales" onclick="cambiarVista('sales')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M3 3v14a2 2 0 002 2h14M7 13l4-4 3 3 5-5" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Ventas</span>
            </button>
            <button class="bottom-nav-item" data-view="asistencia" onclick="cambiarVista('asistencia')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="M10 5v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Asistencia</span>
            </button>
            <button class="bottom-nav-item" id="btnCajaGastosBottom" data-view="caja" onclick="cambiarVista('caja')" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <rect x="2" y="6" width="16" height="10" rx="1" stroke="currentColor" stroke-width="2"/>
                    <path d="M6 6V4a1 1 0 011-1h6a1 1 0 011 1v2" stroke="currentColor" stroke-width="2"/>
                    <circle cx="10" cy="11" r="1.5" fill="currentColor"/>
                </svg>
                <span>Caja</span>
            </button>
            <button class="bottom-nav-item" id="btnAsignarCodigosBottom" data-view="asignar" onclick="cambiarVista('asignar')" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="4" width="14" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M5 7h2M5 10h2M9 7h6M9 10h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span>Asignar</span>
            </button>
        </nav>
    </div>

    <!-- MODAL: Checkout -->
    <div id="modalCobro" class="modal">
        <div class="modal-overlay" onclick="cerrarModalCobro()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Procesar Pago</h3>
                <button class="btn-close" onclick="cerrarModalCobro()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="checkout-total">
                    <span>Total a Pagar</span>
                    <span class="checkout-amount" id="pagoTotal">$0</span>
                </div>

                <div class="payment-methods">
                    <button class="payment-method active" data-metodo="Efectivo" onclick="seleccionarMetodo('Efectivo')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 9v6m-3-3h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Efectivo</span>
                    </button>
                    <button class="payment-method" data-metodo="Tarjeta" onclick="seleccionarMetodo('Tarjeta')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Tarjeta</span>
                    </button>
                    <button class="payment-method" data-metodo="Transferencia" onclick="seleccionarMetodo('Transferencia')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="5" y="2" width="14" height="20" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 18h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Transferencia</span>
                    </button>
                </div>

                <div id="areaEfectivo" class="cash-input-area">
                    <div class="form-group">
                        <label>Monto Entregado</label>
                        <input type="number" id="montoEntregado" class="form-input" placeholder="0" oninput="calcularVuelto()">
                    </div>

                    <div class="quick-cash">
                        <button class="cash-btn" onclick="agregarBillete(1000)">$1.000</button>
                        <button class="cash-btn" onclick="agregarBillete(2000)">$2.000</button>
                        <button class="cash-btn" onclick="agregarBillete(5000)">$5.000</button>
                        <button class="cash-btn" onclick="agregarBillete(10000)">$10.000</button>
                        <button class="cash-btn" onclick="agregarBillete(20000)">$20.000</button>
                        <button class="cash-btn" onclick="agregarBillete(50000)">$50.000</button>
                    </div>

                    <div class="change-display" id="vueltoContainer">
                        <span>Vuelto</span>
                        <span class="change-amount" id="vueltoAmount">$0</span>
                    </div>
                </div>

                <div id="areaTarjeta" class="cash-input-area" style="display: none;">
                    <div class="form-group">
                        <label>üí≥ Monto con Tarjeta</label>
                        <input type="number" id="montoTarjeta" class="form-input" placeholder="Ingresa el monto">
                        <small class="input-helper" id="helperTarjeta">Ingresa el monto a pagar con tarjeta</small>
                    </div>
                </div>

                <div id="areaTransferencia" class="cash-input-area" style="display: none;">
                    <div class="form-group">
                        <label>üì± Monto con Transferencia</label>
                        <input type="number" id="montoTransferencia" class="form-input" placeholder="Ingresa el monto">
                        <small class="input-helper" id="helperTransferencia">Ingresa el monto a pagar con transferencia</small>
                    </div>
                </div>

                <!-- Indicador de progreso de pago -->
                <div id="progresoMixto" class="progreso-pago" style="display:none;">
                    <div class="progreso-header">
                        <span class="progreso-label">üí≥ Pago Mixto</span>
                        <span class="progreso-contador" id="contadorMetodos">1 m√©todo</span>
                    </div>
                    <div class="progreso-bar-container">
                        <div class="progreso-bar" id="barraProgreso" style="width: 0%;"></div>
                    </div>
                    <div class="progreso-info">
                        <span id="textoPagado">Pagado: $0</span>
                        <span id="textoFalta" class="texto-pendiente">Falta: $0</span>
                    </div>
                </div>

                <div id="pagosRegistrados"></div>
                <div id="montoPendiente" style="display:none;">
                    <span>Pendiente:</span>
                    <span id="pendienteAmount">$0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="agregarPagoParcial()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span id="btnPagoParcialText">Registrar Pago</span>
                </button>
                <button class="btn btn-success" id="btnFinalizarVenta" onclick="finalizarVenta()">
                    <span>Finalizar Venta</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Abrir Saco -->
    <div id="modalAbrirSaco" class="modal">
        <div class="modal-overlay" onclick="cerrarModalSaco()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Abrir Saco para Venta a Granel</h3>
                <button class="btn-close" onclick="cerrarModalSaco()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="sack-info">
                    <p><strong>Producto:</strong> <span id="sacoNombre">-</span></p>
                    <p><strong>Stock actual:</strong> <span id="sacoStock">0</span> unidades</p>
                    <p><strong>Peso:</strong> <span id="sacoPeso">-</span></p>
                </div>
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Se descontar√° 1 unidad del inventario al abrir el saco
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalSaco()">Cancelar</button>
                <button class="btn btn-primary" id="btnConfirmarSaco" onclick="confirmarAbrirSaco()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Esc√°ner de C√≥digos -->
    <div id="modalEscaner" class="modal">
        <div class="modal-overlay" onclick="cerrarEscaner()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üì∑ Escanear C√≥digo de Barras</h3>
                <button class="btn-close" onclick="cerrarEscaner()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info" style="margin-bottom: 16px;">
                    <strong id="rolMensaje">Modo Vendedor:</strong> Escanea para agregar al carrito
                </div>
                <div id="reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                <div id="escanerStatus" style="margin-top: 16px; text-align: center; font-weight: 600;"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Producto (Solo Encargado) -->
    <div id="modalEditarProducto" class="modal">
        <div class="modal-overlay" onclick="cerrarModalEditar()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Producto</h3>
                <button class="btn-close" onclick="cerrarModalEditar()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Producto</label>
                    <input type="text" id="editNombre" class="form-input" placeholder="Nombre del producto">
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="editCategoria" class="form-select">
                        <option value="">Seleccionar categor√≠a</option>
                        <option value="Perro Adulto">Perro Adulto</option>
                        <option value="Perro Cachorro">Perro Cachorro</option>
                        <option value="Gato Adulto">Gato Adulto</option>
                        <option value="Gato Kitten">Gato Kitten</option>
                        <option value="Granel">Granel</option>
                        <option value="Accesorios">Accesorios</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="editPrecio" class="form-input" placeholder="Nuevo precio" step="1">
                </div>
                <div class="form-group">
                    <label>Stock Actual</label>
                    <input type="number" id="editStock" class="form-input" placeholder="Nuevo stock" step="0.1">
                </div>
                <div class="form-group">
                    <label>C√≥digo de Barras</label>
                    <input type="text" id="editCodigoBarras" class="form-input" placeholder="C√≥digo de barras (opcional)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="eliminarProducto()" style="margin-right: auto;">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7 3h6M3 5h14M5 5v11a2 2 0 002 2h6a2 2 0 002-2V5M8 9v6M12 9v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Eliminar</span>
                </button>
                <button class="btn btn-secondary" onclick="cerrarModalEditar()">Cancelar</button>
                <button class="btn btn-success" onclick="guardarEdicion()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Detalle de Venta -->
    <div id="modalDetalleVenta" class="modal">
        <div class="modal-overlay" onclick="cerrarModalDetalleVenta()"></div>
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>üßæ Detalle de Venta</h3>
                <button class="btn-close" onclick="cerrarModalDetalleVenta()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="detalleVentaContent">
                <!-- Se llena din√°micamente -->
                <div style="text-align: center; padding: 40px; color: hsl(var(--muted-foreground));">
                    <div class="spinner"></div>
                    <p>Cargando detalle...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalDetalleVenta()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Nuevo Producto (Solo Encargado) -->
    <div id="modalNuevoProducto" class="modal">
        <div class="modal-overlay" onclick="cerrarModalNuevo()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Registrar Nuevo Producto</h3>
                <button class="btn-close" onclick="cerrarModalNuevo()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Producto no encontrado. Reg√≠stralo ahora:
                </div>
                <div class="form-group">
                    <label>C√≥digo de Barras</label>
                    <input type="text" id="nuevoCodigoBarra" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="nuevoNombre" class="form-input" placeholder="Ej: Champion Adulto 25kg">
                </div>
                <div class="form-group">
                    <label>Marca</label>
                    <input type="text" id="nuevoMarca" class="form-input" placeholder="Ej: Champion">
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="nuevoCategoria" class="form-select">
                        <option value="Adulto">Adulto</option>
                        <option value="Cachorro">Cachorro</option>
                        <option value="Senior">Senior</option>
                        <option value="Gato Adulto">Gato Adulto</option>
                        <option value="Gatito">Gatito</option>
                        <option value="Arena">Arena</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Accesorios">Accesorios</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="nuevoPrecio" class="form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Stock Inicial</label>
                    <input type="number" id="nuevoStock" class="form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Stock M√≠nimo</label>
                    <input type="number" id="nuevoStockMin" class="form-input" placeholder="3" value="3">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalNuevo()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarNuevoProducto()">Registrar Producto</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Administrar Precios (Solo Encargado) -->
    <div id="modalAdminPrecios" class="modal">
        <div class="modal-overlay" onclick="cerrarModalAdminPrecios()"></div>
        <div class="modal-content modal-large" style="max-width: 900px;">
            <div class="modal-header">
                <h3>üí∞ Administrar Precios</h3>
                <button class="btn-close" onclick="cerrarModalAdminPrecios()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="max-height: 60vh; overflow-y: auto;">
                    <table class="tabla-precios" style="width: 100%; border-collapse: collapse;">
                        <thead style="position: sticky; top: 0; background: hsl(var(--card)); z-index: 10;">
                            <tr>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid hsl(var(--border));">Producto</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid hsl(var(--border));">Categor√≠a</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid hsl(var(--border));">Stock</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid hsl(var(--border)); width: 150px;">Precio</th>
                            </tr>
                        </thead>
                        <tbody id="tablaAdminPrecios">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalAdminPrecios()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarCambiosPrecios()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Guardar Cambios</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Pago al Personal -->
    <div id="modalPagoPersonal" class="modal">
        <div class="modal-overlay" onclick="cerrarModalPagoPersonal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üë• Registrar Pago al Personal</h3>
                <button class="btn-close" onclick="cerrarModalPagoPersonal()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="formPagoPersonal" onsubmit="registrarPagoPersonal(event)">
                    <div class="form-group">
                        <label for="pagoEmpleado">Nombre del Empleado *</label>
                        <select id="pagoEmpleado" class="form-select" required>
                            <option value="">Seleccionar empleado...</option>
                            <option value="Jonathan R.">Jonathan R.</option>
                            <option value="Sebastian">Sebastian</option>
                            <option value="Juan Antonio">Juan Antonio</option>
                            <option value="Diego Sr.">Diego Sr. (Padre)</option>
                            <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                            <option value="Hugo">Hugo</option>
                            <option value="Pablo">Pablo</option>
                            <option value="Emil">Emil</option>
                            <option value="Jonathan J.">Jonathan J.</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="pagoPuesto">Puesto *</label>
                            <select id="pagoPuesto" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="local">Local</option>
                                <option value="repartidor">Repartidor</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pagoTurno">Turno</label>
                            <select id="pagoTurno" class="form-select">
                                <option value="">Seleccionar...</option>
                                <option value="ma√±ana">Ma√±ana</option>
                                <option value="tarde">Tarde</option>
                                <option value="completo" selected>Completo</option>
                            </select>
                        </div>
                    </div>

                    <div style="background: hsl(var(--secondary)); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <h4 style="font-size: 16px; font-weight: 700; margin: 0 0 16px 0;">üí∞ Detalle de Pagos</h4>
                        
                        <div class="form-group">
                            <label for="pagoJornada">Pago Jornada *</label>
                            <input 
                                type="number" 
                                id="pagoJornada" 
                                class="form-input" 
                                placeholder="15000"
                                required
                                min="0"
                                step="100"
                                oninput="calcularTotalPago()"
                            >
                        </div>

                        <div class="form-group">
                            <label for="pagoAlmuerzo">Pago Almuerzo *</label>
                            <input 
                                type="number" 
                                id="pagoAlmuerzo" 
                                class="form-input" 
                                placeholder="3000"
                                required
                                min="0"
                                step="100"
                                oninput="calcularTotalPago()"
                            >
                        </div>

                        <div class="form-group">
                            <label>Total a Pagar</label>
                            <div style="font-size: 32px; font-weight: 800; color: hsl(var(--success)); text-align: center; padding: 12px; background: white; border-radius: 10px;" id="totalPagoDisplay">
                                $0
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="pagoDiasSemana">D√≠as Trabajados esta Semana</label>
                        <input 
                            type="number" 
                            id="pagoDiasSemana" 
                            class="form-input" 
                            placeholder="1"
                            value="1"
                            min="1"
                            max="7"
                        >
                        <small style="color: hsl(var(--muted-foreground)); font-size: 13px; margin-top: 4px; display: block;">
                            Contador de d√≠as trabajados en la semana (Lunes a Domingo)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="pagoNotas">Notas (opcional)</label>
                        <textarea 
                            id="pagoNotas" 
                            class="form-input" 
                            rows="3"
                            placeholder="Ej: Trabaj√≥ horas extras, reemplaz√≥ a otro empleado, etc."
                            style="resize: vertical; font-family: inherit;"
                        ></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalPagoPersonal()">Cancelar</button>
                <button class="btn btn-success" onclick="registrarPagoPersonal(event)">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Registrar Pago</span>
                </button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="supabase-config.js?v=20260119-fix"></script>
    <script src="script.js?v=20260119-fix"></script>
</body>
</html>
