<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabrofood - Sistema POS</title>

    <!-- META TAGS ANTI-CACH√â -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- PWA META TAGS -->
    <meta name="description" content="Sistema de Punto de Venta y Gesti√≥n de Pedidos para Sabrofood">
    <meta name="theme-color" content="#42B4E6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sabrofood">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="stylesheet" href="style.css?v=20260212-v104">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- BANNER DE ACTUALIZACI√ìN PWA -->
    <div id="updateBanner" class="update-banner" style="display: none;">
        <div class="update-banner-content">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 2v12m0 0l4-4m-4 4l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5 17v2a2 2 0 002 2h10a2 2 0 002-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Nueva versi√≥n disponible con mejoras</span>
        </div>
        <div class="update-banner-actions">
            <button class="btn-update-dismiss" onclick="cerrarBannerActualizacion()">Ahora no</button>
            <button class="btn-update-now" onclick="actualizarApp()">Actualizar</button>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-icon">
                    <svg width="90" height="120" viewBox="0 0 300 400" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- S correctamente orientada -->
                        <path d="M 50 80
                                 C 20 90, 0 120, 0 160
                                 C 0 200, 20 230, 60 250
                                 C 90 265, 120 280, 130 310
                                 C 140 340, 130 370, 100 385
                                 C 80 393, 55 390, 35 380
                                 L 25 410
                                 C 50 423, 80 428, 110 420
                                 C 170 405, 210 360, 210 300
                                 C 210 260, 190 230, 150 210
                                 C 120 195, 90 180, 80 150
                                 C 70 120, 80 90, 110 75
                                 C 135 63, 165 68, 190 85
                                 L 250 60
                                 C 215 30, 170 15, 120 20
                                 C 80 24, 60 50, 50 80 Z"
                              fill="white"
                              opacity="0.95"/>
                    </svg>
                </div>
                <h1>Sabrofood</h1>
                <p>Sistema de Punto de Venta</p>
            </div>
            <div class="login-body">
                <div class="form-group">
                    <label for="loginUsername">Vendedor</label>
                    <select id="loginUsername" class="form-select">
                        <option value="">Seleccionar vendedor...</option>
                        <option value="Jonathan R.">Jonathan R.</option>
                        <option value="Sebastian">Sebastian</option>
                        <option value="Pablo">Pablo</option>
                        <option value="Hugo">Hugo</option>
                        <option value="Tonio">Tonio</option>
                        <option value="Diego Sr.">Diego Sr. (Padre)</option>
                        <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                        <option value="Emil">Emil</option>
                        <option value="Jonathan J.">Jonathan J.</option>
                        <option value="Admin">Admin (Encargado)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input
                        type="password"
                        id="loginPassword"
                        class="form-input"
                        placeholder="Ingresa tu contrase√±a"
                        onkeypress="if(event.key==='Enter') handleLogin()"
                    >
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberDevice">
                        <span>Recordar en este dispositivo</span>
                    </label>
                </div>

                <button id="loginBtn" class="btn btn-primary btn-block" onclick="handleLogin()">
                    <span>Iniciar Sesi√≥n</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <!-- Bot√≥n de actualizaci√≥n forzada -->
                <button
                    type="button"
                    onclick="forzarActualizacion()"
                    class="btn-link btn-force-update"
                >
                    üîÑ ¬øNo ves tus productos? Haz clic aqu√≠
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="app-container" style="display: none;">
        <!-- SIDEBAR (Desktop) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="logo-icon">ÔøΩ</span>
                    <span class="logo-text">Sabrofood</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" data-view="pos" onclick="cambiarVista('pos')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Punto de Venta</span>
                </button>

                <button class="nav-item" data-view="inventory" onclick="cambiarVista('inventory')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 3H8v4h8V3z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Inventario</span>
                </button>

                <button class="nav-item" data-view="bodega" onclick="cambiarVista('bodega')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke="currentColor" stroke-width="2"/>
                        <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
                    </svg>
                    <span>Bodega</span>
                </button>

                <button class="nav-item" data-view="sales" onclick="cambiarVista('sales')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M18 17l-5-5-4 4-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Historial Ventas</span>
                </button>

                <button class="nav-item" data-view="asistencia" onclick="cambiarVista('asistencia')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Asistencia</span>
                </button>

                <button id="btnCajaGastos" class="nav-item" data-view="caja" onclick="cambiarVista('caja')" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="2" y="7" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="14" r="2" fill="currentColor"/>
                        <path d="M12 16v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Caja y Gastos</span>
                </button>

                <button id="btnAsignarCodigos" class="nav-item" data-view="asignar" onclick="cambiarVista('asignar')" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M7 9h2M7 12h2M7 15h2M11 9h6M11 12h6M11 15h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span>Asignar C√≥digos</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="2"/>
                            <path d="M4 17c0-2.8 2.7-5 6-5s6 2.2 6 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="sidebarUsername">Usuario</div>
                        <div class="user-role">Vendedor</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- POS VIEW -->
            <div id="posView" class="view-container">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Punto de Venta</h2>
                        <p class="view-subtitle">Gestiona tus ventas</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="abrirEscaner()" style="margin-right: 12px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M9 9h6M9 12h6M9 15h6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>ESCANEAR</span>
                        </button>

                        <span class="user-badge" id="topUsername">Usuario</span>

                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="pos-layout">
                    <div class="pos-products">
                        <!-- Barcode Scanner - PRINCIPAL -->
                        <div class="search-box barcode-search-main">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="search-icon">
                                <rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M7 9h2M7 12h2M7 15h2M11 9v6M13 9v6M15 9v6M17 9v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <input type="text"
                                   id="inputCodigoBarras"
                                   placeholder="üîç Escanea o escribe el c√≥digo de barras aqu√≠..."
                                   class="search-input barcode-input"
                                   autofocus
                                   autocomplete="off">
                            <button class="btn-clear-search" onclick="limpiarBusquedaCodigo()" style="display: none;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Search Manual (secundario) -->
                        <div class="search-box search-secondary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                                <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                                <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <input type="text"
                                   id="searchInput"
                                   placeholder="O busca por nombre..."
                                   class="search-input">
                        </div>

                        <!-- Categories -->
                        <div class="categories-scroll">
                            <button class="category-chip active" data-categoria="Todos" onclick="filtrarCategoria('Todos')">Todos</button>
                            <button class="category-chip" onclick="abrirModalGranel()" style="background: hsl(var(--success)); color: white; border-color: hsl(var(--success));">üåæ Granel</button>
                            <button class="category-chip" data-categoria="Adulto" onclick="filtrarCategoria('Adulto')">üêï Perro Adulto</button>
                            <button class="category-chip" data-categoria="Cachorro" onclick="filtrarCategoria('Cachorro')">üê∂ Cachorro</button>
                            <button class="category-chip" data-categoria="Senior" onclick="filtrarCategoria('Senior')">ü¶¥ Senior</button>
                            <button class="category-chip" data-categoria="Gato" onclick="filtrarCategoria('Gato')">üêà Gato</button>
                            <button class="category-chip" data-categoria="Gatito" onclick="filtrarCategoria('Gatito')">üê± Gatito</button>
                            <button class="category-chip" data-categoria="Arena" onclick="filtrarCategoria('Arena')">üèñÔ∏è Arena</button>
                            <button class="category-chip" data-categoria="Snacks" onclick="filtrarCategoria('Snacks')">üçñ Snacks</button>
                            <button class="category-chip" data-categoria="Accesorios" onclick="filtrarCategoria('Accesorios')">üéæ Accesorios</button>
                        </div>

                        <!-- Products Grid -->
                        <div class="products-grid" id="productosGrid">
                            <div class="loading-state">
                                <div class="spinner"></div>
                                <p>Cargando productos...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Sidebar -->
                    <div class="pos-cart">
                        <div class="cart-header">
                            <h3>Carrito</h3>
                            <button class="btn-icon" onclick="limpiarCarrito()" title="Limpiar carrito">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                                    <path d="M3 6h14M8 6V4a2 2 0 012-2h0a2 2 0 012 2v2m3 0v10a2 2 0 01-2 2H7a2 2 0 01-2-2V6h10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>

                        <div class="cart-items" id="carritoItems">
                            <div class="cart-empty">
                                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                                    <circle cx="32" cy="32" r="30" stroke="currentColor" stroke-width="2" opacity="0.2"/>
                                    <path d="M20 24h24l-2 16H22l-2-16z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="26" cy="48" r="2" fill="currentColor"/>
                                    <circle cx="38" cy="48" r="2" fill="currentColor"/>
                                </svg>
                                <p>Tu carrito est√° vac√≠o</p>
                                <span>Agrega productos para comenzar</span>
                            </div>
                        </div>

                        <div class="cart-footer">
                            <div class="cart-total">
                                <span>Total</span>
                                <span class="total-amount" id="totalAmount">$0</span>
                            </div>
                            <button class="btn btn-success btn-block" id="btnCobrar" onclick="abrirModalCobro()" disabled>
                                <span>Procesar Pago</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INVENTORY VIEW -->
            <div id="inventoryView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Gesti√≥n de Inventario</h2>
                        <p class="view-subtitle">Control de stock y productos</p>
                    </div>
                    <div class="view-actions">
                        <button id="btnAdminPreciosInventario" class="btn btn-primary" onclick="abrirModalAdminPrecios()" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Administrar Precios</span>
                        </button>

                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="inventory-content">
                    <div class="inventory-stats">
                        <div class="stat-card stat-card-clickable" onclick="filtrarInventario('todos')" data-filtro="todos" title="Ver todos los productos">
                            <div class="stat-icon bg-blue">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M4 7h12M4 7l2-4h8l2 4M4 7v9a2 2 0 002 2h8a2 2 0 002-2V7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Total Productos</p>
                                <p class="stat-value" id="totalProductos">0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-card-clickable" onclick="filtrarInventario('enstock')" data-filtro="enstock" title="Ver solo productos en stock">
                            <div class="stat-icon bg-green">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">En Stock</p>
                                <p class="stat-value" id="enStock">0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-card-clickable" onclick="filtrarInventario('stockbajo')" data-filtro="stockbajo" title="Ver productos con stock bajo">
                            <div class="stat-icon bg-orange">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Stock Bajo</p>
                                <p class="stat-value" id="stockBajo">0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-card-clickable" onclick="filtrarInventario('sinstock')" data-filtro="sinstock" title="Ver productos sin stock">
                            <div class="stat-icon bg-red">
                                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 6v4m0 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <p class="stat-label">Sin Stock</p>
                                <p class="stat-value" id="sinStock">0</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <label for="filtroProveedor" style="margin-right: 10px; font-weight: 500;">Filtrar por Proveedor:</label>
                            <select id="filtroProveedor" onchange="filtrarInventario()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                                <option value="">Todos los proveedores</option>
                                <option value="Sin proveedor">Sin proveedor</option>
                                <option value="Befoods">Befoods</option>
                                <option value="Cruce">Cruce</option>
                                <option value="Argentinos">Argentinos</option>
                                <option value="Mya Spa">Mya Spa</option>
                                <option value="Chile Dog">Chile Dog</option>
                                <option value="Brit Care">Brit Care</option>
                                <option value="Bravery">Bravery</option>
                                <option value="Dragpharma">Dragpharma</option>
                                <option value="Fit formula">Fit formula</option>
                                <option value="Farmacia">Farmacia</option>
                                <option value="Belcando & Leonardo">Belcando & Leonardo</option>
                                <option value="Wampy">Wampy</option>
                                <option value="Josera">Josera</option>
                                <option value="Acomer">Acomer</option>
                                <option value="Dockneddy">Dockneddy</option>
                                <option value="Topk9">Topk9</option>
                                <option value="Cova">Cova</option>
                                <option value="Purina">Purina</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="btnCrearProducto" class="btn btn-success" onclick="abrirModalCrearProducto()" style="display: none;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span>Crear Producto</span>
                            </button>
                            <button id="btnGestionarProveedores" class="btn btn-primary" onclick="abrirModalProveedores()" style="display: none;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M17 18.5V16c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v2.5M15 7.5a3 3 0 11-6 0 3 3 0 016 0zM6 7.5a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>Gestionar Proveedores</span>
                            </button>
                        </div>
                    </div>

                    <div class="inventory-table-container">
                        <table class="inventory-table" id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Proveedor</th>
                                    <th>Categor√≠a</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>C√≥digo de Barras</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <tr>
                                    <td colspan="100%" class="text-center">
                                        <div class="loading-state">
                                            <div class="spinner"></div>
                                            <p>Cargando inventario...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- SALES VIEW -->
            <div id="salesView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>üìä An√°lisis de Ventas</h2>
                        <p class="view-subtitle">Dashboard y registro de transacciones</p>
                    </div>
                    <div class="view-actions">
                        <select id="periodoVentas" class="form-select" onchange="actualizarVentas()" style="min-width: 160px;">
                            <option value="7">√öltimos 7 d√≠as</option>
                            <option value="30" selected>√öltimos 30 d√≠as</option>
                            <option value="90">√öltimos 90 d√≠as</option>
                        </select>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="sales-content">
                    <!-- SECCI√ìN 1: KPIs Expandidos -->
                    <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-green" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(34, 197, 94, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üí∞</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Hoy</p>
                                    <p class="kpi-value" id="kpiVentasHoy" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-blue" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(59, 130, 246, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÖ</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Semana</p>
                                    <p class="kpi-value" id="kpiVentasSemana" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-purple" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(168, 85, 247, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÜ</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ventas Mes</p>
                                    <p class="kpi-value" id="kpiVentasMes" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="kpi-icon bg-orange" style="width: 48px; height: 48px; border-radius: 12px; background: rgba(251, 146, 60, 0.1); display: flex; align-items: center; justify-content: center; font-size: 24px;">üõí</div>
                                <div class="kpi-content">
                                    <p class="kpi-label" style="font-size: 13px; color: hsl(var(--muted-foreground)); margin: 0 0 4px 0;">Ticket Promedio</p>
                                    <p class="kpi-value" id="kpiTicketPromedio" style="font-size: 24px; font-weight: 700; margin: 0;">$0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECCI√ìN 2: Gr√°ficos -->
                    <div class="charts-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 24px;">
                        <!-- Gr√°fico Ventas Diarias -->
                        <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìà Tendencia de Ventas</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="chartVentasDiarias"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico M√©todos de Pago -->
                        <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üí≥ M√©todos de Pago</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="chartMetodosPago"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°fico Top Productos (ancho completo) -->
                    <div class="chart-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üèÜ Top 10 Productos M√°s Vendidos</h3>
                        <div style="height: 350px; position: relative;">
                            <canvas id="chartTopProductos"></canvas>
                        </div>
                    </div>

                    <!-- SECCI√ìN 3: Tabla de Vendedores -->
                    <div id="rankingVendedores" class="vendedores-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üë• Ranking de Vendedores</h3>
                        <div id="tablaVendedores"></div>
                    </div>

                    <!-- SECCI√ìN 4: Tabla de Historial (la actual, mantenerla) -->
                    <div id="historialTransacciones" class="sales-history-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìã Historial de Transacciones</h3>
                        <div class="sales-table-container">
                            <table class="sales-table" id="salesTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha/Hora</th>
                                        <th>Vendedor</th>
                                        <th>Productos</th>
                                        <th>Total</th>
                                        <th>M√©todo Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center">
                                            <div class="loading-state">
                                                <div class="spinner"></div>
                                                <p>Cargando ventas...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ASIGNAR CODIGOS VIEW (Solo Encargado) -->
            <div id="asignarView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Asignar C√≥digos de Barras</h2>
                        <p class="view-subtitle">Gestiona c√≥digos de barras de productos</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="asignar-content">
                    <!-- Search Box -->
                    <div class="search-box" style="margin-bottom: 24px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                            <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <input type="text" id="buscarAsignar" placeholder="Buscar productos sin c√≥digo..." class="search-input" oninput="filtrarProductosAsignar()">
                    </div>

                    <!-- Lista de Productos -->
                    <div id="listaProductosAsignar" style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Cargando productos...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ASISTENCIA VIEW -->
            <div id="asistenciaView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>‚è∞ Asistencia</h2>
                        <p class="view-subtitle">Control de horarios de trabajo</p>
                    </div>
                    <div class="view-actions">
                        <span id="topUsernameAsistencia" class="top-username">Usuario</span>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="asistencia-content" style="padding: 24px;">
                    <!-- Estado Actual -->
                    <div id="estadoActual" class="estado-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 24px; margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìç Estado Actual</h3>
                        <div id="estadoContent">
                            <div class="spinner"></div>
                            <p>Cargando estado...</p>
                        </div>
                    </div>

                    <!-- Botones de Marcaje -->
                    <div class="marcaje-btns" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <button id="btnMarcarEntrada" class="btn btn-success" onclick="marcarEvento('entrada')" style="padding: 20px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Marcar Entrada</div>
                        </button>
                        <button id="btnIniciarAlmuerzo" class="btn btn-warning" onclick="marcarEvento('inicio_almuerzo')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M12 12h9l-9 9v-9zM12 3v9H3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Iniciar Almuerzo</div>
                        </button>
                        <button id="btnTerminarAlmuerzo" class="btn btn-info" onclick="marcarEvento('fin_almuerzo')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 6v6l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <div>Terminar Almuerzo</div>
                        </button>
                        <button id="btnMarcarSalida" class="btn btn-danger" onclick="marcarEvento('salida')" style="padding: 20px;" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="margin-bottom: 8px;">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div>Marcar Salida</div>
                        </button>
                    </div>

                    <!-- Filtros (Solo Admin) -->
                    <div id="filtrosAsistencia" class="filtros-card" style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px; margin-bottom: 24px; display: none;">
                        <div style="display: flex; gap: 16px; align-items: end; flex-wrap: wrap;">
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <label>Vendedor</label>
                                <select id="filtroVendedor" class="form-select" onchange="cargarAsistencias()">
                                    <option value="">Todos los vendedores</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                                <label>Fecha</label>
                                <input type="date" id="filtroFecha" class="form-input" onchange="cargarAsistencias()">
                            </div>
                            <button class="btn btn-primary" onclick="cargarAsistencias()">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                                    <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <span>Buscar</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tabla de Asistencias -->
                    <div style="background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 12px; padding: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 16px 0;">üìã Registro de Asistencias</h3>
                        <div style="overflow-x: auto;">
                            <table class="sales-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Vendedor</th>
                                        <th>Entrada</th>
                                        <th>Inicio Almuerzo</th>
                                        <th>Fin Almuerzo</th>
                                        <th>Salida</th>
                                        <th>Horas</th>
                                        <th>Estado</th>
                                        <th id="thAcciones">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaAsistencias">
                                    <tr>
                                        <td colspan="9" class="text-center">
                                            <div class="loading-state">
                                                <div class="spinner"></div>
                                                <p>Cargando asistencias...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CAJA Y GASTOS VIEW (Solo Encargado) -->
            <div id="cajaView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>üí∞ Caja y Gastos</h2>
                        <p class="view-subtitle">Control de caja diario y arqueo</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="cerrarCajaDiaria()" style="margin-right: 12px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>Cerrar Caja</span>
                        </button>
                        <button class="btn-logout-header" onclick="handleLogout()" title="Cerrar sesi√≥n">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="caja-content">
                    <div class="caja-grid">
                        <!-- PANEL IZQUIERDO: Resumen de Ventas -->
                        <div class="caja-panel">
                            <!-- Sencillo Inicial -->
                            <div class="panel-header">
                                <h3>üíµ Sencillo Inicial</h3>
                                <p class="panel-subtitle">Efectivo de inicio del d√≠a</p>
                            </div>

                            <div class="stats-summary" style="margin-bottom: 32px;">
                                <div class="stat-row" style="background: hsl(var(--info) / 0.1); border: 2px solid hsl(var(--info) / 0.3); padding: 16px;">
                                    <span class="stat-label" style="font-size: 16px;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        Sencillo Inicial
                                    </span>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span class="stat-value" style="color: hsl(var(--info)); font-size: 28px;" id="sencilloInicial">$0</span>
                                        <button 
                                            class="btn btn-sm" 
                                            onclick="editarSencilloInicial()" 
                                            style="padding: 4px 8px; background: white; border: 1px solid hsl(var(--info)); color: hsl(var(--info));"
                                            title="Editar sencillo inicial">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-header">
                                <h3>üìä Ventas del D√≠a</h3>
                                <p class="panel-subtitle" id="cajaFechaHoy">Cargando...</p>
                            </div>

                            <div class="stats-summary">
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        Efectivo
                                    </span>
                                    <span class="stat-value stat-efectivo" id="ventasEfectivo">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                                            <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Tarjeta
                                    </span>
                                    <span class="stat-value stat-transbank" id="ventasTransbank">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M3 3l18 18M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        Transferencia
                                    </span>
                                    <span class="stat-value stat-transferencia" id="ventasTransferencia">$0</span>
                                </div>
                                <div class="stat-row stat-total">
                                    <span class="stat-label"><strong>Total Ventas</strong></span>
                                    <span class="stat-value" id="ventasTotal">$0</span>
                                </div>
                            </div>

                            <!-- Gastos del D√≠a -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üí∏ Gastos del D√≠a</h3>
                            </div>

                            <div class="stats-summary">
                                <div class="stat-row">
                                    <span class="stat-label">Gastos Operacionales</span>
                                    <span class="stat-value stat-gastos" id="gastosTotal">$0</span>
                                </div>
                            </div>

                            <!-- Pagos al Personal -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üë• Pagos al Personal</h3>
                                <p class="panel-subtitle">Pagos registrados hoy</p>
                            </div>

                            <div class="stats-summary">
                                <div class="stat-row" style="cursor: pointer;" onclick="abrirModalEditarPagosPersonal()" title="Click para editar pagos">
                                    <span class="stat-label">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2"/>
                                            <path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Empleados Pagados
                                    </span>
                                    <span class="stat-value" id="cantidadEmpleadosPagados">0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">Total Jornadas</span>
                                    <span class="stat-value" style="color: hsl(var(--info));" id="totalJornadas">$0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">Total Almuerzos</span>
                                    <span class="stat-value" style="color: hsl(var(--warning));" id="totalAlmuerzos">$0</span>
                                </div>
                                <div class="stat-row stat-total" style="background: hsl(var(--success) / 0.1); border: 2px solid hsl(var(--success) / 0.3);">
                                    <span class="stat-label"><strong>üí∞ Total Pagado Personal</strong></span>
                                    <span class="stat-value" style="color: hsl(var(--success));" id="totalPagadoPersonal">$0</span>
                                </div>
                            </div>

                            <!-- Arqueo -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üîç Arqueo de Caja</h3>
                            </div>

                            <div class="arqueo-section">
                                <div class="arqueo-row">
                                    <span>Efectivo Esperado:</span>
                                    <span class="arqueo-value" id="efectivoEsperado">$0</span>
                                </div>
                                <div class="form-group" style="margin: 16px 0;">
                                    <label for="efectivoReal">Efectivo Real en Caja</label>
                                    <input
                                        type="number"
                                        id="efectivoReal"
                                        class="form-input input-efectivo-real"
                                        placeholder="0"
                                        oninput="calcularDiferenciaCaja()"
                                        style="font-size: 24px; font-weight: 700; text-align: center;"
                                    >
                                </div>
                                <div class="arqueo-row arqueo-diferencia" id="diferenciaContainer" style="display: none;">
                                    <span id="diferenciaLabel">Diferencia:</span>
                                    <span class="arqueo-value" id="diferenciaMonto">$0</span>
                                </div>
                            </div>
                        </div>

                        <!-- PANEL DERECHO: Registro de Gastos -->
                        <div class="caja-panel">
                            <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <h3>üí∞ Gastos</h3>
                                <button class="btn btn-success" onclick="abrirModalPagoPersonal()" style="padding: 8px 16px; font-size: 14px;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2"/>
                                        <path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span>Pagar Personal</span>
                                </button>
                            </div>

                            <!-- Registro de Gasto -->
                            <div class="panel-header">
                                <h3>‚ûï Registrar Gasto</h3>
                            </div>

                            <form id="formGasto" class="form-gastos" onsubmit="registrarGasto(event)">
                                <div class="form-group">
                                    <label for="gastoMonto">Monto</label>
                                    <input
                                        type="number"
                                        id="gastoMonto"
                                        class="form-input"
                                        placeholder="0"
                                        required
                                        min="0"
                                        step="100"
                                    >
                                </div>

                                <div class="form-group">
                                    <label for="gastoCategoria">Categor√≠a</label>
                                    <select id="gastoCategoria" class="form-select" required onchange="toggleDescripcionPersonalizada()">
                                        <option value="">Seleccionar categor√≠a...</option>
                                        <option value="Combustible">‚õΩ Combustible</option>
                                        <option value="Peaje">üõ£Ô∏è Peaje</option>
                                        <option value="Aseo">üßπ Aseo</option>
                                        <option value="Bolsas">üõçÔ∏è Bolsas</option>
                                        <option value="Otro">üìù Otro (personalizado)</option>
                                    </select>
                                </div>

                                <div class="form-group" id="descripcionPersonalizadaGroup" style="display: none;">
                                    <label for="gastoDescripcionPersonalizada">Descripci√≥n personalizada</label>
                                    <input
                                        type="text"
                                        id="gastoDescripcionPersonalizada"
                                        class="form-input"
                                        placeholder="Ej: Insumos, Reparaci√≥n, etc."
                                    >
                                </div>

                                <div class="form-group">
                                    <label for="gastoAsignado">Asignado a</label>
                                    <select id="gastoAsignado" class="form-select" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="Jonathan R.">Jonathan R.</option>
                                        <option value="Sebastian">Sebastian</option>
                                        <option value="Juan Antonio">Juan Antonio</option>
                                        <option value="Diego Sr.">Diego Sr. (Padre)</option>
                                        <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                                        <option value="Hugo">Hugo</option>
                                        <option value="Pablo">Pablo</option>
                                        <option value="Emil">Emil</option>
                                        <option value="Jonathan J.">Jonathan J.</option>
                                        <option value="Admin">Admin (Encargado)</option>
                                        <option value="Empresa">Gasto Empresa</option>
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <span>Agregar Gasto</span>
                                </button>
                            </form>

                            <!-- Tabla de Gastos del D√≠a -->
                            <div class="panel-header" style="margin-top: 32px;">
                                <h3>üìã Gastos Registrados Hoy</h3>
                            </div>

                            <div class="gastos-list" id="gastosLista">
                                <div class="empty-state">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="opacity: 0.3; margin: 0 auto 16px;">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <p>No hay gastos registrados hoy</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BODEGA VIRTUAL VIEW -->
            <div id="bodegaView" class="view-container" style="display: none;">
                <div class="view-header">
                    <div class="view-title">
                        <h2>Bodega Virtual</h2>
                        <p class="view-subtitle">Sistema de reposici√≥n inteligente</p>
                    </div>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="mostrarModalSolicitarProducto()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Solicitar Producto</span>
                        </button>
                    </div>
                </div>

                <div class="bodega-layout">
                    <!-- PANEL PRINCIPAL: Lista de Reposici√≥n -->
                    <div class="bodega-panel bodega-panel-main">
                        <div class="panel-header">
                            <h3>üìã Lista de Reposici√≥n</h3>
                            <span class="badge badge-info" id="contadorPendientes">0 pendientes</span>
                        </div>

                        <div class="solicitudes-list" id="listaSolicitudes">
                            <div class="empty-state">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" style="opacity: 0.3;">
                                    <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <p>No hay solicitudes pendientes</p>
                                <span>¬°Todo reabastecido! üéâ</span>
                            </div>
                        </div>
                    </div>

                    <!-- PANEL SECUNDARIO: Historial -->
                    <div class="bodega-panel bodega-panel-historial">
                        <div class="panel-header">
                            <h3>üìú Historial de Hoy</h3>
                            <button class="btn-icon" onclick="cargarHistorialSacos()" title="Actualizar">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M1 4v6h6M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>

                        <div class="historial-list" id="historialSacos">
                            <div class="empty-state-small">
                                <p>No hay registros hoy</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </main>

        <!-- MOBILE BOTTOM NAV -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" data-view="pos" onclick="cambiarVista('pos')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M3 3h6v6H3V3zm8 0h6v6h-6V3zM3 11h6v6H3v-6zm8 0h6v6h-6v-6z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>POS</span>
            </button>
            <button class="bottom-nav-item" data-view="inventory" onclick="cambiarVista('inventory')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M4 7h12M4 7l2-4h8l2 4M4 7v9a2 2 0 002 2h8a2 2 0 002-2V7" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Inventario</span>
            </button>
            <button class="bottom-nav-item" data-view="bodega" onclick="cambiarVista('bodega')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M3 8l7-5 7 5v9a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke="currentColor" stroke-width="2"/>
                    <path d="M8 17V11h4v6" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Bodega</span>
            </button>
            <button class="bottom-nav-item" data-view="sales" onclick="cambiarVista('sales')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <path d="M3 3v14a2 2 0 002 2h14M7 13l4-4 3 3 5-5" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Ventas</span>
            </button>
            <button class="bottom-nav-item" data-view="asistencia" onclick="cambiarVista('asistencia')">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="M10 5v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Asistencia</span>
            </button>
            <button class="bottom-nav-item" id="btnCajaGastosBottom" data-view="caja" onclick="cambiarVista('caja')" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <rect x="2" y="6" width="16" height="10" rx="1" stroke="currentColor" stroke-width="2"/>
                    <path d="M6 6V4a1 1 0 011-1h6a1 1 0 011 1v2" stroke="currentColor" stroke-width="2"/>
                    <circle cx="10" cy="11" r="1.5" fill="currentColor"/>
                </svg>
                <span>Caja</span>
            </button>
            <button class="bottom-nav-item" id="btnAsignarCodigosBottom" data-view="asignar" onclick="cambiarVista('asignar')" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="4" width="14" height="12" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M5 7h2M5 10h2M9 7h6M9 10h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span>Asignar</span>
            </button>
        </nav>
    </div>

    <!-- MODAL: Checkout -->
    <div id="modalCobro" class="modal">
        <div class="modal-overlay" onclick="cerrarModalCobro()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Procesar Pago</h3>
                <button class="btn-close" onclick="cerrarModalCobro()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="checkout-total">
                    <span>Total a Pagar</span>
                    <span class="checkout-amount" id="pagoTotal">$0</span>
                </div>

                <div class="payment-methods">
                    <button class="payment-method active" data-metodo="Efectivo" onclick="seleccionarMetodo('Efectivo')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="6" width="20" height="12" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 9v6m-3-3h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Efectivo</span>
                    </button>
                    <button class="payment-method" data-metodo="Tarjeta" onclick="seleccionarMetodo('Tarjeta')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Tarjeta</span>
                    </button>
                    <button class="payment-method" data-metodo="Transferencia" onclick="seleccionarMetodo('Transferencia')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="5" y="2" width="14" height="20" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 18h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Transferencia</span>
                    </button>
                    <button class="payment-method" data-metodo="Mixto" onclick="seleccionarMetodo('Mixto')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="3" width="9" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                            <rect x="13" y="3" width="9" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                            <rect x="2" y="14" width="9" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                            <rect x="13" y="14" width="9" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Mixto</span>
                    </button>
                </div>

                <div id="areaEfectivo" class="cash-input-area">
                    <div class="form-group">
                        <label>Monto Entregado</label>
                        <input type="number" id="montoEntregado" class="form-input" placeholder="0" oninput="calcularVuelto()">
                    </div>

                    <div class="quick-cash">
                        <button class="cash-btn" onclick="agregarBillete(1000)">$1.000</button>
                        <button class="cash-btn" onclick="agregarBillete(2000)">$2.000</button>
                        <button class="cash-btn" onclick="agregarBillete(5000)">$5.000</button>
                        <button class="cash-btn" onclick="agregarBillete(10000)">$10.000</button>
                        <button class="cash-btn" onclick="agregarBillete(20000)">$20.000</button>
                        <button class="cash-btn" onclick="agregarBillete(50000)">$50.000</button>
                    </div>

                    <div class="change-display" id="vueltoContainer">
                        <span>Vuelto</span>
                        <span class="change-amount" id="vueltoAmount">$0</span>
                    </div>
                </div>

                <div id="areaTarjeta" class="cash-input-area" style="display: none;">
                    <div class="form-group">
                        <label>üí≥ Monto con Tarjeta</label>
                        <input type="number" id="montoTarjeta" class="form-input" placeholder="Ingresa el monto">
                        <small class="input-helper" id="helperTarjeta">Ingresa el monto a pagar con tarjeta</small>
                    </div>
                </div>

                <div id="areaTransferencia" class="cash-input-area" style="display: none;">
                    <div class="form-group">
                        <label>üì± Monto con Transferencia</label>
                        <input type="number" id="montoTransferencia" class="form-input" placeholder="Ingresa el monto">
                        <small class="input-helper" id="helperTransferencia">Ingresa el monto a pagar con transferencia</small>
                    </div>
                </div>

                <div id="areaMixto" class="cash-input-area" style="display: none;">
                    <div class="alert" style="background: hsl(48 96% 89%); border-color: hsl(48 96% 70%); margin-bottom: 16px;">
                        üí° <strong>Pago Mixto:</strong> Ingresa el monto para cada m√©todo que uses. El sistema calcular√° autom√°ticamente el restante.
                    </div>
                    
                    <div class="form-group">
                        <label>üíµ Efectivo</label>
                        <input type="number" id="montoMixtoEfectivo" class="form-input" placeholder="0" oninput="calcularPagoMixto()">
                    </div>
                    
                    <div class="form-group">
                        <label>üí≥ Tarjeta</label>
                        <input type="number" id="montoMixtoTarjeta" class="form-input" placeholder="0" oninput="calcularPagoMixto()">
                    </div>
                    
                    <div class="form-group">
                        <label>üì± Transferencia</label>
                        <input type="number" id="montoMixtoTransferencia" class="form-input" placeholder="0" oninput="calcularPagoMixto()">
                    </div>

                    <div class="progreso-pago" style="display: block; margin-top: 16px;">
                        <div class="progreso-info" style="display: flex; justify-content: space-between; padding: 12px; background: hsl(var(--muted)/0.3); border-radius: 8px;">
                            <div>
                                <div style="font-size: 12px; color: hsl(var(--muted-foreground)); margin-bottom: 4px;">Total:</div>
                                <div style="font-weight: 700; font-size: 18px;" id="totalMixtoDisplay">$0</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: hsl(var(--muted-foreground)); margin-bottom: 4px;">Ingresado:</div>
                                <div style="font-weight: 700; font-size: 18px; color: hsl(142 76% 36%);" id="pagadoMixtoDisplay">$0</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: hsl(var(--muted-foreground)); margin-bottom: 4px;">Falta:</div>
                                <div style="font-weight: 700; font-size: 18px; color: hsl(0 84% 60%);" id="faltaMixtoDisplay">$0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Indicador de progreso de pago -->
                <div id="progresoMixto" class="progreso-pago" style="display:none;">
                    <div class="progreso-header">
                        <span class="progreso-label">üí≥ Pago Mixto</span>
                        <span class="progreso-contador" id="contadorMetodos">1 m√©todo</span>
                    </div>
                    <div class="progreso-bar-container">
                        <div class="progreso-bar" id="barraProgreso" style="width: 0%;"></div>
                    </div>
                    <div class="progreso-info">
                        <span id="textoPagado">Pagado: $0</span>
                        <span id="textoFalta" class="texto-pendiente">Falta: $0</span>
                    </div>
                </div>

                <div id="pagosRegistrados"></div>
                <div id="montoPendiente" style="display:none;">
                    <span>Pendiente:</span>
                    <span id="pendienteAmount">$0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="btnFinalizarVenta" onclick="finalizarVenta()">
                    <span>Finalizar Venta</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Abrir Saco -->
    <div id="modalAbrirSacoGranel" class="modal">
        <div class="modal-overlay" onclick="cerrarModalSaco()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Abrir Saco para Venta a Granel</h3>
                <button class="btn-close" onclick="cerrarModalSaco()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="sack-info">
                    <p><strong>Producto:</strong> <span id="sacoNombre">-</span></p>
                    <p><strong>Stock actual:</strong> <span id="sacoStock">0</span> unidades</p>
                    <p><strong>Peso:</strong> <span id="sacoPeso">-</span></p>
                </div>
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Se descontar√° 1 unidad del inventario al abrir el saco
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalSaco()">Cancelar</button>
                <button class="btn btn-primary" id="btnConfirmarSaco" onclick="confirmarAbrirSaco()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Esc√°ner de C√≥digos -->
    <div id="modalEscaner" class="modal">
        <div class="modal-overlay" onclick="cerrarEscaner()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üì∑ Escanear C√≥digo de Barras</h3>
                <button class="btn-close" onclick="cerrarEscaner()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info" style="margin-bottom: 16px;">
                    <strong id="rolMensaje">Modo Vendedor:</strong> Escanea para agregar al carrito
                </div>
                <div id="reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                <div id="escanerStatus" style="margin-top: 16px; text-align: center; font-weight: 600;"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: Venta a Granel -->
    <div id="modalGranel" class="modal">
        <div class="modal-overlay" onclick="cerrarModalGranel()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üåæ Venta a Granel</h3>
                <button class="btn-close" onclick="cerrarModalGranel()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- B√∫squeda de producto granel -->
                <div class="form-group">
                    <label>Buscar Producto a Granel</label>
                    <div class="search-box">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                            <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <input type="text"
                               id="searchGranelInput"
                               placeholder="Buscar por nombre..."
                               class="search-input"
                               oninput="filtrarProductosGranel()">
                    </div>
                </div>

                <!-- Lista de productos granel -->
                <div class="form-group">
                    <label>Productos Disponibles (Precio por kg)</label>
                    <div id="listaProductosGranel" style="max-height: 300px; overflow-y: auto; border: 1px solid hsl(var(--border)); border-radius: 8px; padding: 8px;">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Cargando productos...</p>
                        </div>
                    </div>
                </div>

                <!-- Producto seleccionado -->
                <div id="granelSeleccionado" style="display: none;">
                    <div class="alert alert-success" style="margin-bottom: 16px;">
                        <strong id="granelNombreSeleccionado"></strong>
                        <br>
                        <span id="granelPrecioKg" style="font-size: 14px;"></span>
                    </div>

                    <div class="form-group">
                        <label>Monto Total Vendido ($)</label>
                        <input type="number" 
                               id="granelMonto" 
                               class="form-input" 
                               placeholder="Ej: 5000" 
                               min="0" 
                               step="100"
                               oninput="calcularPesoEstimado()">
                        <small style="color: hsl(var(--muted-foreground)); font-size: 12px; margin-top: 4px; display: block;">
                            üí° Peso estimado: <strong id="pesoEstimado">0 kg</strong>
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalGranel()">Cancelar</button>
                <button class="btn btn-success" onclick="agregarGranelAlCarrito()" id="btnAgregarGranel" disabled>Agregar al Carrito</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar/Crear Producto (Solo Encargado) -->
    <div id="modalEditarProducto" class="modal">
        <div class="modal-overlay" onclick="cerrarModalEditar()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="tituloModalProducto">‚úèÔ∏è Editar Producto</h3>
                <button class="btn-close" onclick="cerrarModalEditar()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Producto</label>
                    <input type="text" id="editNombre" class="form-input" placeholder="Nombre del producto">
                </div>
                <div class="form-group">
                    <label>Proveedor (opcional)</label>
                    <select id="editProveedor" class="form-select">
                        <option value="">Sin proveedor</option>
                        <option value="Befoods">Befoods</option>
                        <option value="Cruce">Cruce</option>
                        <option value="Argentinos">Argentinos</option>
                        <option value="Mya Spa">Mya Spa</option>
                        <option value="Chile Dog">Chile Dog</option>
                        <option value="Brit Care">Brit Care</option>
                        <option value="Bravery">Bravery</option>
                        <option value="Dragpharma">Dragpharma</option>
                        <option value="Fit formula">Fit formula</option>
                        <option value="Farmacia">Farmacia</option>
                        <option value="Belcando & Leonardo">Belcando & Leonardo</option>
                        <option value="Wampy">Wampy</option>
                        <option value="Josera">Josera</option>
                        <option value="Acomer">Acomer</option>
                        <option value="Dockneddy">Dockneddy</option>
                        <option value="Topk9">Topk9</option>
                        <option value="Cova">Cova</option>
                        <option value="Purina">Purina</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="editCategoria" class="form-select">
                        <option value="">Seleccionar categor√≠a</option>
                        <option value="Adulto">Perro Adulto</option>
                        <option value="Cachorro">Cachorro</option>
                        <option value="Senior">Senior</option>
                        <option value="Gato Adulto">Gato Adulto</option>
                        <option value="Gatito">Gatito</option>
                        <option value="Arena">Arena</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Accesorios">Accesorios</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="editPrecio" class="form-input" placeholder="Nuevo precio" step="1">
                </div>
                <div class="form-group">
                    <label>Stock Actual</label>
                    <input type="number" id="editStock" class="form-input" placeholder="Nuevo stock" step="0.1">
                </div>
                <div class="form-group" id="editStockMinimoGroup" style="display: none;">
                    <label>Stock M√≠nimo (Alerta)</label>
                    <input type="number" id="editStockMinimo" class="form-input" placeholder="Stock m√≠nimo para alerta" step="1" min="0">
                    <small style="color: hsl(var(--muted-foreground)); font-size: 12px;">
                        üö® Se activar√° alerta cuando el stock sea menor a este valor
                    </small>
                </div>
                <div class="form-group">
                    <label>C√≥digo de Barras</label>
                    <input type="text" id="editCodigoBarras" class="form-input" placeholder="C√≥digo de barras (opcional)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="btnEliminarProducto" onclick="eliminarProducto()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M7 3h6M3 5h14M5 5v11a2 2 0 002 2h6a2 2 0 002-2V5M8 9v6M12 9v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Eliminar</span>
                </button>
                <button class="btn btn-secondary" onclick="cerrarModalEditar()">Cancelar</button>
                <button class="btn btn-success" id="btnGuardarProducto" onclick="guardarEdicion()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Detalle de Venta -->
    <div id="modalDetalleVenta" class="modal">
        <div class="modal-overlay" onclick="cerrarModalDetalleVenta()"></div>
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>üßæ Detalle de Venta</h3>
                <button class="btn-close" onclick="cerrarModalDetalleVenta()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="detalleVentaContent">
                <!-- Se llena din√°micamente -->
                <div style="text-align: center; padding: 40px; color: hsl(var(--muted-foreground));">
                    <div class="spinner"></div>
                    <p>Cargando detalle...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="imprimirBoleta()" style="gap: 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <rect x="6" y="14" width="12" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Imprimir Boleta
                </button>
                <button class="btn btn-secondary" onclick="cerrarModalDetalleVenta()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Nuevo Producto (Solo Encargado) -->
    <div id="modalNuevoProducto" class="modal">
        <div class="modal-overlay" onclick="cerrarModalNuevo()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Registrar Nuevo Producto</h3>
                <button class="btn-close" onclick="cerrarModalNuevo()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Producto no encontrado. Reg√≠stralo ahora:
                </div>
                <div class="form-group">
                    <label>C√≥digo de Barras</label>
                    <input type="text" id="nuevoCodigoBarra" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="nuevoNombre" class="form-input" placeholder="Ej: Champion Adulto 25kg">
                </div>
                <div class="form-group">
                    <label>Marca</label>
                    <input type="text" id="nuevoMarca" class="form-input" placeholder="Ej: Champion">
                </div>
                <div class="form-group">
                    <label>Proveedor (opcional)</label>
                    <select id="nuevoProveedor" class="form-select">
                        <option value="">Sin proveedor</option>
                        <option value="Befoods">Befoods</option>
                        <option value="Cruce">Cruce</option>
                        <option value="Argentinos">Argentinos</option>
                        <option value="Mya Spa">Mya Spa</option>
                        <option value="Chile Dog">Chile Dog</option>
                        <option value="Brit Care">Brit Care</option>
                        <option value="Bravery">Bravery</option>
                        <option value="Dragpharma">Dragpharma</option>
                        <option value="Fit formula">Fit formula</option>
                        <option value="Farmacia">Farmacia</option>
                        <option value="Belcando & Leonardo">Belcando & Leonardo</option>
                        <option value="Wampy">Wampy</option>
                        <option value="Josera">Josera</option>
                        <option value="Acomer">Acomer</option>
                        <option value="Dockneddy">Dockneddy</option>
                        <option value="Topk9">Topk9</option>
                        <option value="Cova">Cova</option>
                        <option value="Purina">Purina</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="nuevoCategoria" class="form-select">
                        <option value="">Seleccionar categor√≠a</option>
                        <option value="Adulto">Perro Adulto</option>
                        <option value="Cachorro">Cachorro</option>
                        <option value="Senior">Senior</option>
                        <option value="Gato Adulto">Gato Adulto</option>
                        <option value="Gatito">Gatito</option>
                        <option value="Arena">Arena</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Accesorios">Accesorios</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="number" id="nuevoPrecio" class="form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Stock Inicial</label>
                    <input type="number" id="nuevoStock" class="form-input" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Stock M√≠nimo</label>
                    <input type="number" id="nuevoStockMin" class="form-input" placeholder="3" value="3">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalNuevo()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarNuevoProducto()">Registrar Producto</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Administrar Precios (Solo Encargado) -->
    <div id="modalAdminPrecios" class="modal">
        <div class="modal-overlay" onclick="cerrarModalAdminPrecios()"></div>
        <div class="modal-content modal-large" style="max-width: 900px;">
            <div class="modal-header">
                <h3>üí∞ Administrar Precios</h3>
                <button class="btn-close" onclick="cerrarModalAdminPrecios()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="max-height: 60vh; overflow-y: auto;">
                    <table class="tabla-precios" style="width: 100%; border-collapse: collapse;">
                        <thead style="position: sticky; top: 0; background: hsl(var(--card)); z-index: 10;">
                            <tr>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid hsl(var(--border));">Producto</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid hsl(var(--border));">Categor√≠a</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid hsl(var(--border));">Stock</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid hsl(var(--border)); width: 150px;">Precio</th>
                            </tr>
                        </thead>
                        <tbody id="tablaAdminPrecios">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalAdminPrecios()">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarCambiosPrecios()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Guardar Cambios</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Pago al Personal -->
    <div id="modalPagoPersonal" class="modal">
        <div class="modal-overlay" onclick="cerrarModalPagoPersonal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üë• Registrar Pago al Personal</h3>
                <button class="btn-close" onclick="cerrarModalPagoPersonal()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="formPagoPersonal" onsubmit="registrarPagoPersonal(event)">
                    <div class="form-group">
                        <label for="pagoEmpleado">Nombre del Empleado *</label>
                        <select id="pagoEmpleado" class="form-select" required>
                            <option value="">Seleccionar empleado...</option>
                            <option value="Jonathan R.">Jonathan R.</option>
                            <option value="Sebastian">Sebastian</option>
                            <option value="Juan Antonio">Juan Antonio</option>
                            <option value="Diego Sr.">Diego Sr. (Padre)</option>
                            <option value="Diego Jr.">Diego Jr. (Hijo)</option>
                            <option value="Hugo">Hugo</option>
                            <option value="Pablo">Pablo</option>
                            <option value="Emil">Emil</option>
                            <option value="Jonathan J.">Jonathan J.</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="pagoPuesto">Puesto *</label>
                            <select id="pagoPuesto" class="form-select" required>
                                <option value="">Seleccionar...</option>
                                <option value="local">Local</option>
                                <option value="repartidor">Repartidor</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pagoTurno">Turno</label>
                            <select id="pagoTurno" class="form-select">
                                <option value="">Seleccionar...</option>
                                <option value="ma√±ana">Ma√±ana</option>
                                <option value="tarde">Tarde</option>
                                <option value="completo" selected>Completo</option>
                            </select>
                        </div>
                    </div>

                    <div style="background: hsl(var(--secondary)); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <h4 style="font-size: 16px; font-weight: 700; margin: 0 0 16px 0;">üí∞ Detalle de Pagos</h4>

                        <div class="form-group">
                            <label for="pagoJornada">Pago Jornada *</label>
                            <input
                                type="number"
                                id="pagoJornada"
                                class="form-input"
                                placeholder="15000"
                                required
                                min="0"
                                step="100"
                                oninput="calcularTotalPago()"
                            >
                        </div>

                        <div class="form-group">
                            <label for="pagoAlmuerzo">Pago Almuerzo *</label>
                            <input
                                type="number"
                                id="pagoAlmuerzo"
                                class="form-input"
                                placeholder="3000"
                                required
                                min="0"
                                step="100"
                                oninput="calcularTotalPago()"
                            >
                        </div>

                        <div class="form-group">
                            <label>Total a Pagar</label>
                            <div style="font-size: 32px; font-weight: 800; color: hsl(var(--success)); text-align: center; padding: 12px; background: white; border-radius: 10px;" id="totalPagoDisplay">
                                $0
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="pagoDiasSemana">D√≠as Trabajados esta Semana</label>
                        <input
                            type="number"
                            id="pagoDiasSemana"
                            class="form-input"
                            placeholder="1"
                            value="1"
                            min="1"
                            max="7"
                        >
                        <small style="color: hsl(var(--muted-foreground)); font-size: 13px; margin-top: 4px; display: block;">
                            Contador de d√≠as trabajados en la semana (Lunes a Domingo)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="pagoNotas">Notas (opcional)</label>
                        <textarea
                            id="pagoNotas"
                            class="form-input"
                            rows="3"
                            placeholder="Ej: Trabaj√≥ horas extras, reemplaz√≥ a otro empleado, etc."
                            style="resize: vertical; font-family: inherit;"
                        ></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalPagoPersonal()">Cancelar</button>
                <button class="btn btn-success" onclick="registrarPagoPersonal(event)">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M5 10l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Registrar Pago</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Pagos al Personal -->
    <div id="modalEditarPagosPersonal" class="modal">
        <div class="modal-overlay" onclick="cerrarModalEditarPagosPersonal()"></div>
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Pagos al Personal</h3>
                <button class="btn-close" onclick="cerrarModalEditarPagosPersonal()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="helper-text">Edita los montos de jornada y almuerzo de los empleados pagados hoy.</p>

                <div id="listaPagosPersonalEditar" style="margin-top: 20px;">
                    <!-- Lista de pagos se carga din√°micamente -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalEditarPagosPersonal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Gestionar Proveedores (Solo Encargado) -->
    <div id="modalProveedores" class="modal">
        <div class="modal-overlay" onclick="cerrarModalProveedores()"></div>
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>üè¢ Gestionar Proveedores</h3>
                <button class="btn-close" onclick="cerrarModalProveedores()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Formulario para agregar/editar proveedor -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px;">
                        <span id="tituloFormProveedor">‚ûï Agregar Proveedor</span>
                    </h4>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label for="inputNombreProveedor" style="display: block; margin-bottom: 5px; font-weight: 500;">Nombre del Proveedor</label>
                            <input type="text" id="inputNombreProveedor" placeholder="Ej: Befoods, Purina, etc." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button id="btnGuardarProveedor" class="btn btn-success" onclick="guardarProveedor()">
                            <span id="textoBotonProveedor">Agregar</span>
                        </button>
                        <button id="btnCancelarEditProveedor" class="btn btn-secondary" onclick="cancelarEditarProveedor()" style="display: none;">
                            Cancelar
                        </button>
                    </div>
                </div>

                <!-- Lista de proveedores -->
                <div>
                    <h4 style="margin: 0 0 15px 0; font-size: 16px;">üìã Lista de Proveedores</h4>
                    <div id="listaProveedores" style="max-height: 400px; overflow-y: auto;">
                        <!-- Se carga din√°micamente -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalProveedores()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Solicitar Producto para Reposici√≥n -->
    <div id="modalSolicitarProducto" class="modal">
        <div class="modal-overlay" onclick="cerrarModalSolicitarProducto()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì¶ Solicitar Reposici√≥n</h3>
                <button class="btn-close" onclick="cerrarModalSolicitarProducto()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="helper-text">Busca el producto que necesitas reponer y agr√©galo a la lista compartida.</p>

                <div class="search-box" style="margin-bottom: 20px;">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
                        <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
                        <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <input
                        type="text"
                        id="buscarProductoReposicion"
                        placeholder="Buscar producto a granel..."
                        class="search-input"
                        oninput="buscarProductosParaReposicion()"
                        autofocus
                    >
                </div>

                <div id="resultadosBusquedaReposicion" class="productos-busqueda-list">
                    <div class="empty-state-small">
                        <p>Escribe para buscar productos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√≥n Flotante Carrito M√≥vil -->
    <button id="btnCarritoMobile" class="btn-cart-float" onclick="toggleCarritoMobile()">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" class="cart-icon">
            <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="9" cy="21" r="1.5" fill="currentColor"/>
            <circle cx="18" cy="21" r="1.5" fill="currentColor"/>
        </svg>
        <span id="badgeCarritoMobile" class="cart-badge" style="display: none;">0</span>
    </button>

    <!-- Overlay Carrito M√≥vil -->
    <div id="overlayCarritoMobile" class="cart-mobile-overlay" onclick="cerrarCarritoMobile()"></div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="supabase-config.js?v=20260119-fix"></script>
    <script src="script.js?v=20260216-devolucion"></script>
    <script src="bodega-module.js?v=20260211-cleaned"></script>
    <script src="pwa-install.js?v=20260212-pwa"></script>

    <!-- PWA SERVICE WORKER REGISTRATION -->
    <script>
        // Variable global para el nuevo Service Worker
        let newServiceWorker = null;

        // Funci√≥n para mostrar el banner de actualizaci√≥n
        function mostrarBannerActualizacion() {
            const banner = document.getElementById('updateBanner');
            if (banner) {
                banner.style.display = 'flex';
            }
        }

        // Funci√≥n para cerrar el banner
        function cerrarBannerActualizacion() {
            const banner = document.getElementById('updateBanner');
            if (banner) {
                banner.style.display = 'none';
            }
        }

        // Funci√≥n para actualizar la app
        function actualizarApp() {
            if (newServiceWorker) {
                newServiceWorker.postMessage({ type: 'SKIP_WAITING' });
            }
            cerrarBannerActualizacion();
        }

        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Detectar si estamos en GitHub Pages o local
                const swPath = window.location.hostname === 'nutria005.github.io' 
                    ? '/sabrofood/service-worker.js' 
                    : '/service-worker.js';
                
                navigator.serviceWorker.register(swPath)
                    .then((registration) => {
                        console.log('‚úÖ PWA: Service Worker registrado:', registration.scope);

                        // Detectar actualizaciones del Service Worker
                        registration.addEventListener('updatefound', () => {
                            newServiceWorker = registration.installing;
                            
                            newServiceWorker.addEventListener('statechange', () => {
                                if (newServiceWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üîÑ PWA: Nueva versi√≥n disponible');
                                    // Mostrar banner de actualizaci√≥n
                                    mostrarBannerActualizacion();
                                }
                            });
                        });

                        // Verificar actualizaciones cada 30 segundos
                        setInterval(() => {
                            registration.update();
                        }, 30000);
                    })
                    .catch((error) => {
                        console.error('‚ùå PWA: Error al registrar Service Worker:', error);
                    });

                // Recargar cuando el nuevo SW tome control
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    console.log('üîÑ Recargando con nueva versi√≥n...');
                    window.location.reload();
                });
            });
        }
    </script>
</body>
</html>
